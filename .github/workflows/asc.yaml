name: ASC-1.3 Integrity
# Authority: Avant Systems Canon (Clause 8)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  governance:
    name: Governance Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Verify Codeowners
        run: |
          if [ ! -f .github/CODEOWNERS ]; then
            echo "::error::CODEOWNERS file missing. Violation of Tier 0 Governance."
            exit 1
          fi

  system-integrity:
    name: Nix Flake Verification
    runs-on: ubuntu-latest
    needs: governance
    steps:
      - uses: actions/checkout@v4
      - uses: cachix/install-nix-action@v27
        with:
          nix_path: nixpkgs=channel:nixos-unstable
    
      - name: Syntax Check
        run: nix flake check